## 垃圾回收

##### 执行上下文栈

执行全局代码时，会产生一个执行上下文环境，每次调用函数都又会执行上下文环境。当函数调用完成时，这个上下文环境以及其中的数据都会被消除（当然了闭包并不会乖乖就范），**处于活动状态的执行上下文环境只有一个**。

JavaScript是使用垃圾回收的语言，也就说执行环境负责在代码执行时管理内存。基本思路：周期性的确定哪个变量不会再用，就释放它占用的内存，每隔一段时间就自动运行这个机制。但是，某块内存是否还有用是不可预测的，单靠算法不能解决。

所以，垃圾回收机制必须跟踪记录哪个变量还会使用，哪个变量不会不再需要，以便回收内存。如何标记未使用的变量也有不同的实现方式，最常用的有：标记清除和引用计数。

##### 标记清除

当变量加入上下文，比如在函数内部声明一个变量，就会为这个变量加上 一个存在于上下文的标记。当变量离开上下文时，也会被加上离开上下文的标记。

当垃圾回收机制运行时，先会给内存中的所有变量加上标记，之后再将运行在上下文内的变量以及被在上下文中的变量引用的变量的标记去掉，最后再被加上标记的变量就是待删除的变量了。

##### 引用计数

引用计数相对于标记清除没那么常用。它的基本思路就是，对每一个值都记录它被引用的次数，引用一次加1。首次声明是，这个值的引用数为1。以此类推，如果保存对该值的引用变量被其它值覆盖了，那么引用数减1。直到减为0，则不可再访问到这个值，即可安全回收该变量。等到垃圾回收程序运行时，就会释放引用数为0 的值的内存。